# LangChain4j Phase 2.1: RAG (Retrieval Augmented Generation) âœ…

## ğŸ“š í•™ìŠµ ëª©í‘œ

- **RAG ê°œë… ì´í•´**: ë¬¸ì„œ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œì˜ í•µì‹¬ ì›ë¦¬
- **ë²¡í„° ì„ë² ë”©**: í…ìŠ¤íŠ¸ë¥¼ ìˆ«ì ë²¡í„°ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ìˆ 
- **ìœ ì‚¬ë„ ê²€ìƒ‰**: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ í™œìš©í•œ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
- **ë¬¸ì„œ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸**: ë¡œë”© â†’ ë¶„í•  â†’ ì„ë² ë”© â†’ ì €ì¥ â†’ ê²€ìƒ‰
- **ì‹¤ì „ ì‘ìš©**: íšŒì‚¬ ë¬¸ì„œ Q&A, ì œí’ˆ ë§¤ë‰´ì–¼ ì±—ë´‡ ë“±

---

## ğŸ¯ êµ¬í˜„ ì™„ë£Œ ë‚´ìš©

### 1. ì˜ì¡´ì„± ì¶”ê°€

**íŒŒì¼**: `build.gradle`

```gradle
// Phase 2.1: RAG (Retrieval Augmented Generation) ì§€ì›
// Document loaders - ë‹¤ì–‘í•œ íŒŒì¼ í˜•ì‹ ì§€ì›
implementation "dev.langchain4j:langchain4j-document-parser-apache-tika:${langchain4jVersion}"
// Embedding models - í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜
implementation "dev.langchain4j:langchain4j-embeddings-all-minilm-l6-v2:${langchain4jVersion}"
```

---

### 2. RAG Assistant ì¸í„°í˜ì´ìŠ¤

**íŒŒì¼**: `src/main/java/langhchainback/langchain/AI/RAG/RagAssistant.java`

```java
public interface RagAssistant {
    // ë¬¸ì„œ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ
    String answer(String question, String information);

    // ë¬¸ì„œ ìš”ì•½
    String summarizeDocument(String documentContent);
}
```

**í•µì‹¬ ê¸°ëŠ¥**:

- `@SystemMessage`ë¡œ ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€ë§Œ í•˜ë„ë¡ ì œí•œ
- `{{information}}` í”Œë ˆì´ìŠ¤í™€ë”ì— ê²€ìƒ‰ëœ ë¬¸ì„œ ì£¼ì…
- í™˜ê°(hallucination) ìµœì†Œí™”

---

### 3. RAG Service (í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

**íŒŒì¼**: `src/main/java/langhchainback/langchain/AI/RAG/RagService.java`

**3ê°€ì§€ ì£¼ìš” ë©”ì„œë“œ**:

#### ğŸ“„ ë¬¸ì„œ ìˆ˜ì§‘ (Document Ingestion)

```java
int ingestDocument(MultipartFile file, String documentId)
```

**í”„ë¡œì„¸ìŠ¤**:

1. **íŒŒì¼ íŒŒì‹±** - Apache Tikaë¡œ PDF, DOCX, TXT ë“± ìë™ ì¸ì‹
2. **ë¬¸ì„œ ë¶„í•  (Chunking)** - 300ì ë‹¨ìœ„, 30ì ê²¹ì¹¨
3. **ì„ë² ë”© ìƒì„±** - AllMiniLmL6V2 ëª¨ë¸ (384ì°¨ì› ë²¡í„°)
4. **ë²¡í„° ì €ì¥** - InMemoryEmbeddingStoreì— ì €ì¥

#### ğŸ” ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰ (Retrieval)

```java
String searchRelevantContent(String question, int maxResults, double minScore)
```

**ì‘ë™ ì›ë¦¬**:

1. ì§ˆë¬¸ì„ ë²¡í„°ë¡œ ë³€í™˜
2. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¡œ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
3. ìœ ì‚¬ë„ ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§ (ê¸°ë³¸ 0.7)
4. ìƒìœ„ Nê°œ ë¬¸ì„œ ì¡°ê° ë°˜í™˜

#### ğŸ’¬ ì§ˆì˜ì‘ë‹µ (Question Answering)

```java
String answerQuestion(String question)
```

**ì „ì²´ RAG íŒŒì´í”„ë¼ì¸**:

1. `searchRelevantContent()` í˜¸ì¶œí•˜ì—¬ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
2. ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ `RagAssistant`ì˜ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „ë‹¬
3. AIê°€ ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€ ìƒì„±

---

### 4. REST API Controller

**íŒŒì¼**: `src/main/java/langhchainback/langchain/AI/RAG/RagController.java`

**ì œê³µ API**:

| ì—”ë“œí¬ì¸íŠ¸    | ë©”ì„œë“œ | ì„¤ëª…                      |
| ------------- | ------ | ------------------------- |
| `/rag/ingest` | POST   | ë¬¸ì„œ ì—…ë¡œë“œ ë° ë²¡í„°í™”     |
| `/rag/ask`    | POST   | ë¬¸ì„œ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ        |
| `/rag/search` | POST   | ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰ (ë””ë²„ê¹…ìš©) |

---

### 5. Spring Bean ì„¤ì •

**íŒŒì¼**: `src/main/java/langhchainback/langchain/Config/LangChainConfig.java`

**3ê°€ì§€ Bean**:

#### ğŸ§  Embedding Model

```java
@Bean
public EmbeddingModel embeddingModel()
```

- **AllMiniLmL6V2** ê²½ëŸ‰ ëª¨ë¸ (23MB)
- ë¡œì»¬ ì‹¤í–‰ ê°€ëŠ¥ (API í˜¸ì¶œ ì—†ìŒ)
- 384ì°¨ì› ë²¡í„° ìƒì„±
- ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´ í¬í•¨)

#### ğŸ’¾ Embedding Store

```java
@Bean
public EmbeddingStore<TextSegment> embeddingStore()
```

- **InMemoryEmbeddingStore** (ê°œë°œìš©)
- ë¹ ë¥¸ ì†ë„, ë©”ëª¨ë¦¬ ê¸°ë°˜
- âš ï¸ ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì†Œì‹¤

#### ğŸ¤– RAG Assistant

```java
@Bean
public RagAssistant ragAssistant()
```

- Gemini 2.5 Flash ëª¨ë¸
- Temperature 0.3 (ì •í™•ì„± ìš°ì„ )
- ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€ ì „ë¬¸

---

### 6. í”„ë¡ íŠ¸ì—”ë“œ UI

**íŒŒì¼**: `langchainfront/app/pages/rag/index.vue`

**ì£¼ìš” ê¸°ëŠ¥**:

- âœ… íŒŒì¼ ì—…ë¡œë“œ (ë“œë˜ê·¸ & ë“œë¡­ ì§€ì›)
- âœ… ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ (ì‚¬ìš©ì/AI ë©”ì‹œì§€ êµ¬ë¶„)
- âœ… ì‹¤ì‹œê°„ ì²˜ë¦¬ ìƒíƒœ í‘œì‹œ
- âœ… ì—ëŸ¬ í•¸ë“¤ë§ ë° ì•Œë¦¼
- âœ… ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ (Vuetify)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ì¤€ë¹„ ì‚¬í•­

#### 1. ë°±ì—”ë“œ ì‹¤í–‰

```bash
cd langchain
./gradlew bootRun
```

#### 2. í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰

```bash
cd langchainfront
npm run dev
```

#### 3. í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ì¤€ë¹„

- PDF, DOCX, TXT íŒŒì¼ ì¤€ë¹„
- ì˜ˆ: íšŒì‚¬ ê·œì •ì§‘, ì œí’ˆ ë§¤ë‰´ì–¼, FAQ ë¬¸ì„œ ë“±

---

## ğŸ“¡ API í…ŒìŠ¤íŠ¸ ì˜ˆì œ

### 1ï¸âƒ£ ë¬¸ì„œ ì—…ë¡œë“œ (Document Ingestion)

```bash
curl -X POST http://localhost:8080/rag/ingest \
  -F "file=@company_handbook.pdf" \
  -F "documentId=handbook-2024"
```

**ì‘ë‹µ ì˜ˆì‹œ**:

```json
{
  "success": true,
  "message": "ë¬¸ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "chunkCount": 42,
  "documentId": "handbook-2024"
}
```

**í•´ì„**:

- ë¬¸ì„œê°€ **42ê°œì˜ ì²­í¬**ë¡œ ë¶„í• ë¨
- ê° ì²­í¬ëŠ” ì•½ 300ì ë‚´ì™¸
- ëª¨ë‘ ë²¡í„° DBì— ì €ì¥ë¨

---

### 2ï¸âƒ£ ë¬¸ì„œ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ

```bash
curl -X POST http://localhost:8080/rag/ask \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ì—°ì°¨ëŠ” ëª‡ì¼ì¸ê°€ìš”?"
  }'
```

**ì‘ë‹µ ì˜ˆì‹œ**:

```json
{
  "success": true,
  "message": "ë‹µë³€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "answer": "ë‹µë³€: ê·¼ì†ì—°ìˆ˜ì— ë”°ë¼ ì—°ì°¨ëŠ” 15~25ì¼ì…ë‹ˆë‹¤.\n\nì¶œì²˜: íšŒì‚¬ ë³µë¦¬í›„ìƒ ê·œì • 3ì¥ 2ì ˆì— ë”°ë¥´ë©´...",
  "originalQuestion": "ì—°ì°¨ëŠ” ëª‡ì¼ì¸ê°€ìš”?"
}
```

**RAG íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê³¼ì •**:

1. ì§ˆë¬¸ "ì—°ì°¨ëŠ” ëª‡ì¼ì¸ê°€ìš”?" ì„ë² ë”© ìƒì„±
2. ë²¡í„° DBì—ì„œ ìœ ì‚¬í•œ ë¬¸ì„œ ê²€ìƒ‰ (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)
3. ê²€ìƒ‰ëœ ë¬¸ì„œ: "ë³µë¦¬í›„ìƒ ê·œì • 3ì¥...", "íœ´ê°€ ì‚¬ìš© ì•ˆë‚´..." ë“±
4. AIê°€ ë¬¸ì„œ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ ìƒì„±
5. ì¶œì²˜ ì •ë³´ í¬í•¨í•˜ì—¬ ì‘ë‹µ

---

### 3ï¸âƒ£ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰ (ë””ë²„ê¹…ìš©)

```bash
curl -X POST http://localhost:8080/rag/search \
  -H "Content-Type: application/json" \
  -d '{
    "question": "í‡´ì§ê¸ˆ ê³„ì‚° ë°©ë²•",
    "maxResults": 3,
    "minScore": 0.7
  }'
```

**ì‘ë‹µ ì˜ˆì‹œ**:

```json
{
  "success": true,
  "message": "ê²€ìƒ‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
  "relevantContent": "[ìœ ì‚¬ë„: 0.89]\ní‡´ì§ê¸ˆ ê³„ì‚° ë°©ë²•ì€ ê·¼ì†ì—°ìˆ˜ Ã— í‰ê· ì„ê¸ˆ Ã— 30ì¼ì…ë‹ˆë‹¤...\n\n---\n\n[ìœ ì‚¬ë„: 0.76]\ní‡´ì§ê¸ˆ ì§€ê¸‰ ê¸°ì¤€ì€ 1ë…„ ì´ìƒ ê·¼ë¬´í•œ ì§ì›ì—ê²Œ...",
  "resultCount": 2,
  "minScore": 0.7
}
```

**ìš©ë„**:

- ì–´ë–¤ ë¬¸ì„œê°€ ê²€ìƒ‰ë˜ëŠ”ì§€ í™•ì¸
- ìœ ì‚¬ë„ ì ìˆ˜ ê²€ì¦
- ì²­í¬ ë¶„í• ì´ ì ì ˆí•œì§€ ê²€í† 

---

## ğŸ”‘ í•µì‹¬ ê°œë… ì •ë¦¬

### 1. RAGë€?

**Retrieval Augmented Generation** - ê²€ìƒ‰ ê¸°ë°˜ ì¦ê°• ìƒì„±

```
ê¸°ì¡´ AI: ì§ˆë¬¸ â†’ AI ëª¨ë¸ â†’ ë‹µë³€ (í•™ìŠµ ë°ì´í„° ê¸°ë°˜)
RAG AI:  ì§ˆë¬¸ â†’ ë¬¸ì„œ ê²€ìƒ‰ â†’ AI ëª¨ë¸ + ë¬¸ì„œ â†’ ë‹µë³€
```

**ì¥ì **:

- âœ… **ì •í™•ì„±**: ì‹¤ì œ ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€
- âœ… **ìµœì‹ ì„±**: ë¬¸ì„œë§Œ ì—…ë°ì´íŠ¸í•˜ë©´ OK
- âœ… **ì¶”ì ì„±**: ì¶œì²˜ê°€ ëª…í™•í•¨
- âœ… **í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€**: ì—†ëŠ” ì •ë³´ ë§Œë“¤ì§€ ì•ŠìŒ

---

### 2. ë²¡í„° ì„ë² ë”© (Vector Embedding)

#### ê°œë…

í…ìŠ¤íŠ¸ë¥¼ ê³ ì°¨ì› ìˆ«ì ë°°ì—´(ë²¡í„°)ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ìˆ 

#### ì˜ˆì‹œ

```
"í‡´ì§ê¸ˆ ê³„ì‚°"    â†’ [0.123, -0.456, 0.789, ..., 0.234]  (384ê°œ ìˆ«ì)
"í‡´ì§ê¸ˆ ì‚°ì •"    â†’ [0.125, -0.450, 0.791, ..., 0.231]  (ìœ ì‚¬í•œ ë²¡í„°!)
"ë‚ ì”¨ ì˜ˆë³´"      â†’ [0.891, 0.234, -0.567, ..., -0.123] (ë‹¤ë¥¸ ë²¡í„°)
```

#### íŠ¹ì§•

- ì˜ë¯¸ê°€ ìœ ì‚¬í•œ í…ìŠ¤íŠ¸ = ìœ ì‚¬í•œ ë²¡í„°
- ë²¡í„° ê°„ ê±°ë¦¬ë¡œ ìœ ì‚¬ë„ ì¸¡ì • (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)
- ë‹¨ì–´ê°€ ë‹¬ë¼ë„ ì˜ë¯¸ê°€ ê°™ìœ¼ë©´ ê°€ê¹Œì›€

---

### 3. ì½”ì‚¬ì¸ ìœ ì‚¬ë„ (Cosine Similarity)

#### ìˆ˜ì‹

```
similarity = cos(Î¸) = (A Â· B) / (|A| Ã— |B|)
```

#### ë²”ìœ„

- **1.0**: ì™„ì „íˆ ë™ì¼
- **0.7 ~ 0.9**: ë§¤ìš° ìœ ì‚¬ (ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©)
- **0.5 ~ 0.7**: ì•½ê°„ ê´€ë ¨
- **< 0.5**: ê´€ë ¨ ì—†ìŒ

#### ì„ê³„ê°’ ì„¤ì •

```java
// ë†’ì€ ì •í™•ë„ í•„ìš” (ë²•ë¥ , ì˜ë£Œ)
double minScore = 0.85;

// ì¼ë°˜ì ì¸ ì‚¬ìš©
double minScore = 0.7;

// í­ë„“ì€ ê²€ìƒ‰
double minScore = 0.5;
```

---

### 4. ë¬¸ì„œ ë¶„í•  (Chunking)

#### ì™œ í•„ìš”í•œê°€?

1. **AI í† í° ì œí•œ**: GPT-3.5ëŠ” 4096 í† í°, GeminiëŠ” 32K í† í°
2. **ì •í™•í•œ ê²€ìƒ‰**: ê¸´ ë¬¸ì„œ ì „ì²´ë³´ë‹¤ ê´€ë ¨ ë¶€ë¶„ë§Œ ì¶”ì¶œ
3. **ë©”ëª¨ë¦¬ íš¨ìœ¨**: í° ë¬¸ì„œë¥¼ í•œë²ˆì— ì²˜ë¦¬ ë¶ˆê°€

#### ë¶„í•  ì „ëµ

```java
DocumentSplitter splitter = DocumentSplitters.recursive(
    300,  // maxSegmentSizeInChars: ì²­í¬ í¬ê¸°
    30    // maxOverlapSizeInChars: ì²­í¬ ê°„ ê²¹ì¹¨
);
```

#### ê²¹ì¹¨(Overlap)ì˜ ì¤‘ìš”ì„±

```
ì²­í¬ 1: "...í‡´ì§ê¸ˆì€ ê·¼ì†ì—°ìˆ˜ì— ë¹„ë¡€í•©ë‹ˆë‹¤. ê³„ì‚° ë°©ë²•ì€..."
ì²­í¬ 2: "...ê³„ì‚° ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. í‰ê· ì„ê¸ˆ Ã— ê·¼ì†ì—°ìˆ˜..."
                    â†‘ ê²¹ì¹˜ëŠ” ë¶€ë¶„ (ì—°ì†ì„± ìœ ì§€)
```

---

### 5. ì „ì²´ RAG ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG ì‹œìŠ¤í…œ íë¦„                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[1ë‹¨ê³„: ë¬¸ì„œ ìˆ˜ì§‘ (Offline)]
íŒŒì¼ ì—…ë¡œë“œ (PDF, DOCX, TXT)
    â†“
íŒŒì¼ íŒŒì‹± (Apache Tika)
    â†“
ë¬¸ì„œ ë¶„í•  (300ì ì²­í¬, 30ì ê²¹ì¹¨)
    â†“
ì„ë² ë”© ìƒì„± (AllMiniLmL6V2)
    â†“
ë²¡í„° DB ì €ì¥ (InMemoryEmbeddingStore)

[2ë‹¨ê³„: ì§ˆì˜ì‘ë‹µ (Online)]
ì‚¬ìš©ì ì§ˆë¬¸
    â†“
ì§ˆë¬¸ ì„ë² ë”© ìƒì„±
    â†“
ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)
    â†“
ìƒìœ„ Nê°œ ë¬¸ì„œ ì¡°ê° ì¶”ì¶œ
    â†“
AI ëª¨ë¸ì— ë¬¸ì„œ + ì§ˆë¬¸ ì „ë‹¬
    â†“
ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€ ìƒì„±
    â†“
ì‚¬ìš©ìì—ê²Œ ì‘ë‹µ
```

---

## ğŸ’¡ ì‹¤ì „ í™œìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: íšŒì‚¬ ë‚´ë¶€ ê·œì • Q&A

**ì—…ë¡œë“œ ë¬¸ì„œ**:

- ì¸ì‚¬ ê·œì •ì§‘ (50 í˜ì´ì§€)
- ë³µë¦¬í›„ìƒ ì•ˆë‚´ (30 í˜ì´ì§€)
- íœ´ê°€ ì‚¬ìš© ê°€ì´ë“œ (20 í˜ì´ì§€)

**ì§ˆë¬¸ ì˜ˆì‹œ**:

```
Q: "ìœ¡ì•„íœ´ì§ì€ ëª‡ ê°œì›”ê¹Œì§€ ê°€ëŠ¥í•œê°€ìš”?"
A: "ìœ¡ì•„íœ´ì§ì€ ìµœëŒ€ 12ê°œì›”ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    ì¸ì‚¬ ê·œì • 7ì¥ 3ì ˆì— ë”°ë¥´ë©´..."

Q: "ì¬íƒê·¼ë¬´ ì‹ ì²­ ì ˆì°¨ëŠ”?"
A: "ì¬íƒê·¼ë¬´ëŠ” ë‹¤ìŒ ì ˆì°¨ë¡œ ì‹ ì²­í•©ë‹ˆë‹¤:
    1. í†µí•© ì‹œìŠ¤í…œ ì ‘ì†
    2. ì¬íƒê·¼ë¬´ ì‹ ì²­ì„œ ì‘ì„±
    ..."
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì œí’ˆ ê¸°ìˆ  ì§€ì› ì±—ë´‡

**ì—…ë¡œë“œ ë¬¸ì„œ**:

- ì œí’ˆ ì‚¬ìš© ì„¤ëª…ì„œ
- ë¬¸ì œ í•´ê²° ê°€ì´ë“œ
- FAQ ëª¨ìŒ

**ì§ˆë¬¸ ì˜ˆì‹œ**:

```
Q: "ë°°í„°ë¦¬ê°€ ë¹¨ë¦¬ ë‹³ëŠ”ë° ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?"
A: "ë°°í„°ë¦¬ ì†Œëª¨ê°€ ë¹ ë¥¸ ê²½ìš° ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
    1. ë°±ê·¸ë¼ìš´ë“œ ì•± ì¢…ë£Œ
    2. í™”ë©´ ë°ê¸° ì¡°ì ˆ
    3. ì ˆì „ ëª¨ë“œ í™œì„±í™”
    (ì¶œì²˜: ë¬¸ì œ í•´ê²° ê°€ì´ë“œ 3ì¥)"
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë²•ë¥ /ì˜ë£Œ ë¬¸ì„œ ê²€ìƒ‰

**ì—…ë¡œë“œ ë¬¸ì„œ**:

- íŒë¡€ ëª¨ìŒ
- ë²•ë¥  ì¡°ë¬¸
- í•´ì„ ìë£Œ

**ì§ˆë¬¸ ì˜ˆì‹œ**:

```
Q: "ê·¼ë¡œê¸°ì¤€ë²• ìƒ ì—°ì¥ê·¼ë¡œ í•œë„ëŠ”?"
A: "ê·¼ë¡œê¸°ì¤€ë²• ì œ53ì¡°ì— ë”°ë¥´ë©´
    ì—°ì¥ê·¼ë¡œëŠ” ì£¼ 12ì‹œê°„ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    ë‹¨, íŠ¹ë³„í•œ ì‚¬ì •ì´ ìˆëŠ” ê²½ìš°..."
```

---

## ğŸ“ ì‹¤ì „ ì—°ìŠµ ê³¼ì œ

### ê³¼ì œ 1: ë‹¤ì–‘í•œ ë¬¸ì„œ í˜•ì‹ í…ŒìŠ¤íŠ¸

**ëª©í‘œ**: ë‹¤ì–‘í•œ íŒŒì¼ í˜•ì‹ ì—…ë¡œë“œ ë° ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

**ë‹¨ê³„**:

1. PDF íŒŒì¼ ì—…ë¡œë“œ (ì˜ˆ: ë…¼ë¬¸, ë³´ê³ ì„œ)
2. DOCX íŒŒì¼ ì—…ë¡œë“œ (ì˜ˆ: íšŒì˜ë¡)
3. TXT íŒŒì¼ ì—…ë¡œë“œ (ì˜ˆ: ë¡œê·¸, ë©”ëª¨)
4. ê° ë¬¸ì„œì— ëŒ€í•´ ì§ˆë¬¸í•˜ê³  ì •í™•ë„ í™•ì¸

**ê²€ì¦ í¬ì¸íŠ¸**:

- [ ] ëª¨ë“  í˜•ì‹ì´ ì •ìƒì ìœ¼ë¡œ íŒŒì‹±ë˜ëŠ”ê°€?
- [ ] í•œê¸€ì´ ê¹¨ì§€ì§€ ì•ŠëŠ”ê°€?
- [ ] í‘œ, ì´ë¯¸ì§€ ë“±ì€ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ê°€?

---

### ê³¼ì œ 2: ì²­í¬ í¬ê¸° ìµœì í™”

**ëª©í‘œ**: ë¬¸ì„œ íŠ¹ì„±ì— ë§ëŠ” ìµœì  ì²­í¬ í¬ê¸° ì°¾ê¸°

**ì‹¤í—˜**:

```java
// ì‘ì€ ì²­í¬ (ì •ë°€ ê²€ìƒ‰)
DocumentSplitters.recursive(100, 10);

// ì¤‘ê°„ ì²­í¬ (ê· í˜•)
DocumentSplitters.recursive(300, 30);

// í° ì²­í¬ (ë¬¸ë§¥ ì¤‘ì‹œ)
DocumentSplitters.recursive(500, 50);
```

**ë¹„êµ ë¶„ì„**:

- ê° ì„¤ì •ìœ¼ë¡œ ë™ì¼ ë¬¸ì„œ ì²˜ë¦¬
- ë™ì¼ ì§ˆë¬¸ìœ¼ë¡œ ë‹µë³€ í’ˆì§ˆ ë¹„êµ
- ì²˜ë¦¬ ì‹œê°„ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ì •

---

### ê³¼ì œ 3: ìœ ì‚¬ë„ ì„ê³„ê°’ ì‹¤í—˜

**ëª©í‘œ**: ìµœì ì˜ ìœ ì‚¬ë„ ì„ê³„ê°’ ì°¾ê¸°

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:

```java
// ë§¤ìš° ì—„ê²© (ì •í™•ë„ ìš°ì„ )
searchRelevantContent(question, 3, 0.9);

// ì¼ë°˜ (ê· í˜•)
searchRelevantContent(question, 3, 0.7);

// ê´€ëŒ€ (ì¬í˜„ìœ¨ ìš°ì„ )
searchRelevantContent(question, 3, 0.5);
```

**í‰ê°€ ê¸°ì¤€**:

- **ì •ë°€ë„**: ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì‹¤ì œë¡œ ê´€ë ¨ìˆëŠ”ê°€?
- **ì¬í˜„ìœ¨**: ê´€ë ¨ ë¬¸ì„œë¥¼ ëª¨ë‘ ì°¾ì•˜ëŠ”ê°€?
- **ì‚¬ìš©ì ë§Œì¡±ë„**: ë‹µë³€ì´ ì¶©ë¶„í•œê°€?

---

### ê³¼ì œ 4: ë‹¤êµ­ì–´ ë¬¸ì„œ ì§€ì›

**ëª©í‘œ**: ì˜ì–´, ì¼ë³¸ì–´ ë“± ë‹¤êµ­ì–´ ë¬¸ì„œ ì²˜ë¦¬

**ê³¼ì œ ë‚´ìš©**:

1. ì˜ì–´ PDF ì—…ë¡œë“œ
2. í•œêµ­ì–´ë¡œ ì§ˆë¬¸
3. ë‹µë³€ì´ ì ì ˆí•œì§€ í™•ì¸

**ë„ì „ ê³¼ì œ**:

- ì§ˆë¬¸ ì–¸ì–´ì™€ ë¬¸ì„œ ì–¸ì–´ê°€ ë‹¤ë¥¸ ê²½ìš° ì²˜ë¦¬
- ë²ˆì—­ ê¸°ëŠ¥ ì¶”ê°€ ê³ ë ¤

---

## ğŸ”§ ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

### 1. ë²¡í„° ì €ì¥ì†Œ ì—…ê·¸ë ˆì´ë“œ

#### í˜„ì¬ (ê°œë°œìš©)

```java
@Bean
public EmbeddingStore<TextSegment> embeddingStore() {
    return new InMemoryEmbeddingStore<>();
}
```

#### í”„ë¡œë•ì…˜ (PostgreSQL + pgvector)

```java
@Bean
public EmbeddingStore<TextSegment> embeddingStore(DataSource dataSource) {
    return PgVectorEmbeddingStore.builder()
            .dataSource(dataSource)
            .table("document_embeddings")
            .dimension(384)
            .build();
}
```

**ì¥ì **:

- âœ… ì˜êµ¬ ì €ì¥ (ì¬ì‹œì‘ í›„ì—ë„ ìœ ì§€)
- âœ… ëŒ€ìš©ëŸ‰ ë¬¸ì„œ ì²˜ë¦¬ ê°€ëŠ¥
- âœ… íŠ¸ëœì­ì…˜ ì§€ì›
- âœ… ë°±ì—… ë° ë³µêµ¬ ê°€ëŠ¥

---

### 2. ì„ë² ë”© ëª¨ë¸ ì„ íƒ

| ëª¨ë¸           | ì°¨ì› | ì„±ëŠ¥       | ë¹„ìš© | ìš©ë„        |
| -------------- | ---- | ---------- | ---- | ----------- |
| AllMiniLmL6V2  | 384  | â­â­â­     | ë¬´ë£Œ | ê°œë°œ/ì†Œê·œëª¨ |
| OpenAI ada-002 | 1536 | â­â­â­â­â­ | ìœ ë£Œ | í”„ë¡œë•ì…˜    |
| Google PaLM    | 768  | â­â­â­â­   | ìœ ë£Œ | ì¤‘ëŒ€í˜•      |

**OpenAI ì„ë² ë”© ì‚¬ìš© ì˜ˆì‹œ**:

```gradle
implementation "dev.langchain4j:langchain4j-open-ai:${langchain4jVersion}"
```

```java
@Bean
public EmbeddingModel embeddingModel(@Value("${openai.api.key}") String apiKey) {
    return OpenAiEmbeddingModel.builder()
            .apiKey(apiKey)
            .modelName("text-embedding-ada-002")
            .build();
}
```

---

### 3. ìºì‹± ì „ëµ

```java
@Service
@RequiredArgsConstructor
@Slf4j
public class RagService {

    @Cacheable(value = "ragAnswers", key = "#question")
    public String answerQuestion(String question) {
        // ë™ì¼ ì§ˆë¬¸ì€ ìºì‹œì—ì„œ ì¦‰ì‹œ ë°˜í™˜
        // ...
    }
}
```

**ì„¤ì •**:

```properties
spring.cache.type=redis
spring.redis.host=localhost
spring.redis.port=6379
```

---

## ğŸ“Š í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ì´ˆ ê°œë…

- [ ] RAGê°€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] ë²¡í„° ì„ë² ë”©ì˜ ì›ë¦¬ë¥¼ ì´í•´í•œë‹¤
- [ ] ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° ë°©ë²•ì„ ì•ˆë‹¤
- [ ] ë¬¸ì„œ ì²­í‚¹ì´ ì™œ í•„ìš”í•œì§€ ì´í•´í•œë‹¤

### êµ¬í˜„ ëŠ¥ë ¥

- [ ] ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ê³  ë²¡í„°í™”í•  ìˆ˜ ìˆë‹¤
- [ ] APIë¥¼ í†µí•´ ì§ˆì˜ì‘ë‹µì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤
- [ ] í”„ë¡ íŠ¸ì—”ë“œ UIë¡œ RAG ì‹œìŠ¤í…œì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
- [ ] ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë””ë²„ê¹…í•  ìˆ˜ ìˆë‹¤

### ìµœì í™”

- [ ] ì²­í¬ í¬ê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆë‹¤
- [ ] ìœ ì‚¬ë„ ì„ê³„ê°’ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] ë‹¤ì–‘í•œ íŒŒì¼ í˜•ì‹ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤
- [ ] í”„ë¡œë•ì…˜ ë²¡í„° DBë¡œ ì „í™˜í•  ìˆ˜ ìˆë‹¤

### ì‹¤ì „ ì‘ìš©

- [ ] íšŒì‚¬ ë¬¸ì„œ Q&A ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤
- [ ] ì œí’ˆ ë§¤ë‰´ì–¼ ì±—ë´‡ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤
- [ ] ì„±ëŠ¥ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆë‹¤
- [ ] ì‚¬ìš©ì í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ê°œì„ í•  ìˆ˜ ìˆë‹¤

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„: Phase 2.2 - AI ì—ì´ì „íŠ¸

Phase 2.1 RAGë¥¼ ì™„ë£Œí–ˆë‹¤ë©´ ë‹¤ìŒìœ¼ë¡œ ë°°ìš¸ ë‚´ìš©:

### Phase 2.2 ì£¼ìš” ë‚´ìš©:

1. **AI Tools** - AIê°€ í•¨ìˆ˜/ë„êµ¬ë¥¼ í˜¸ì¶œí•˜ë„ë¡ í•˜ê¸°
2. **Function Calling** - ë‚ ì”¨ ì¡°íšŒ, DB ì¿¼ë¦¬ ë“±
3. **Multi-Agent System** - ì—¬ëŸ¬ AIê°€ í˜‘ì—…í•˜ëŠ” ì‹œìŠ¤í…œ
4. **Autonomous Agent** - ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ììœ¨ì ìœ¼ë¡œ í–‰ë™

**ì˜ˆì‹œ**:

```
ì‚¬ìš©ì: "ì˜¤ëŠ˜ ì„œìš¸ ë‚ ì”¨ ì•Œë ¤ì£¼ê³ , ë¹„ ì˜¤ë©´ ìš°ì‚° ì¶”ì²œí•´ì¤˜"

AI ì—ì´ì „íŠ¸:
1. [Tool: ë‚ ì”¨ API í˜¸ì¶œ] â†’ ì„œìš¸ ë‚ ì”¨ = ë¹„
2. [Tool: ìƒí’ˆ ê²€ìƒ‰] â†’ ìš°ì‚° ëª©ë¡ ì¡°íšŒ
3. [ì‘ë‹µ ìƒì„±] â†’ "ì„œìš¸ì€ ë¹„ê°€ ì˜µë‹ˆë‹¤. ì¶”ì²œ ìš°ì‚°: ..."
```

---

## ğŸ› ï¸ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ë¬¸ì œ 1: ë¬¸ì„œ ì—…ë¡œë“œ ì‹¤íŒ¨

**ì¦ìƒ**:

```json
{
  "success": false,
  "message": "ë¬¸ì„œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: Could not parse document"
}
```

**ì›ì¸**: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ ë˜ëŠ” ì†ìƒëœ íŒŒì¼

**í•´ê²°ì±…**:

1. íŒŒì¼ í˜•ì‹ í™•ì¸ (PDF, DOCX, TXTë§Œ ì§€ì›)
2. íŒŒì¼ í¬ê¸° í™•ì¸ (Spring Boot max file size ì„¤ì •)
3. íŒŒì¼ ì¸ì½”ë”© í™•ì¸ (UTF-8 ê¶Œì¥)

```properties
# application.properties
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
```

---

### ë¬¸ì œ 2: ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ

**ì¦ìƒ**:

```
"ê´€ë ¨ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
```

**ì›ì¸**: ìœ ì‚¬ë„ ì„ê³„ê°’ì´ ë„ˆë¬´ ë†’ìŒ

**í•´ê²°ì±…**:

```java
// ì„ê³„ê°’ì„ ë‚®ì¶°ì„œ ì¬ê²€ìƒ‰
searchRelevantContent(question, 5, 0.5);  // 0.7 â†’ 0.5
```

---

### ë¬¸ì œ 3: ë‹µë³€ í’ˆì§ˆ ì €í•˜

**ì¦ìƒ**: AIê°€ ë¬¸ì„œì™€ ê´€ë ¨ ì—†ëŠ” ë‹µë³€ ìƒì„±

**ì›ì¸**: ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ë¶€ì ì ˆí•¨

**í•´ê²°ì±…**:

1. `/rag/search` APIë¡œ ê²€ìƒ‰ ê²°ê³¼ í™•ì¸
2. ì²­í¬ í¬ê¸° ì¡°ì • (300 â†’ 500)
3. ìœ ì‚¬ë„ ì„ê³„ê°’ ìƒí–¥ (0.7 â†’ 0.8)
4. ë¬¸ì„œ í’ˆì§ˆ ê°œì„  (ëª…í™•í•œ ì œëª©, êµ¬ì¡°í™”ëœ ë‚´ìš©)

---

### ë¬¸ì œ 4: ë©”ëª¨ë¦¬ ë¶€ì¡±

**ì¦ìƒ**:

```
java.lang.OutOfMemoryError: Java heap space
```

**ì›ì¸**: ëŒ€ìš©ëŸ‰ ë¬¸ì„œ ì²˜ë¦¬ ë˜ëŠ” ë„ˆë¬´ ë§ì€ ë²¡í„° ì €ì¥

**í•´ê²°ì±…**:

```bash
# JVM í™ ë©”ëª¨ë¦¬ ì¦ê°€
./gradlew bootRun -Dspring-boot.run.jvmArguments="-Xmx2g"
```

ë˜ëŠ” í”„ë¡œë•ì…˜ ë²¡í„° DBë¡œ ì „í™˜ (PostgreSQL + pgvector)

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ

- [LangChain4j RAG Tutorial](https://docs.langchain4j.dev/tutorials/rag)
- [Apache Tika Documentation](https://tika.apache.org/)
- [Vector Database Comparison](https://www.datacamp.com/blog/the-top-5-vector-databases)

### ì„ë² ë”© ëª¨ë¸

- [Sentence Transformers](https://www.sbert.net/)
- [OpenAI Embeddings](https://platform.openai.com/docs/guides/embeddings)
- [HuggingFace Models](https://huggingface.co/models?pipeline_tag=sentence-similarity)

### ë²¡í„° DB

- [PostgreSQL pgvector](https://github.com/pgvector/pgvector)
- [Pinecone](https://www.pinecone.io/)
- [Weaviate](https://weaviate.io/)
- [Chroma](https://www.trychroma.com/)

### ë…¼ë¬¸

- [Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks](https://arxiv.org/abs/2005.11401)
- [Dense Passage Retrieval](https://arxiv.org/abs/2004.04906)

---

## ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!

RAG ì‹œìŠ¤í…œ êµ¬ì¶•ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸŠ

ì´ì œ ì—¬ëŸ¬ë¶„ì€:

- âœ… ë¬¸ì„œ ê¸°ë°˜ AI ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âœ… ë²¡í„° ì„ë² ë”©ê³¼ ìœ ì‚¬ë„ ê²€ìƒ‰ì„ ì´í•´í•©ë‹ˆë‹¤
- âœ… ì‹¤ì „ í”„ë¡œì íŠ¸ì— RAGë¥¼ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âœ… í”„ë¡œë•ì…˜ í™˜ê²½ìœ¼ë¡œ í™•ì¥í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤

**ë‹¤ìŒ ë„ì „**:

- Phase 2.2: AI ì—ì´ì „íŠ¸ êµ¬ì¶•
- Phase 3: ë©€í‹°ëª¨ë‹¬ AI (ì´ë¯¸ì§€, ì˜¤ë””ì˜¤)
- Phase 4: í”„ë¡œë•ì…˜ ë°°í¬ (Docker, Kubernetes)

---

**êµ¬í˜„ ì™„ë£Œ ë‚ ì§œ**: 2025-01-23  
**í•™ìŠµ ì†Œìš” ì‹œê°„**: 2-3ì‹œê°„  
**ë‚œì´ë„**: â­â­â­â­â˜†  
**ë‹¤ìŒ í•™ìŠµ**: Phase 2.2 - AI ì—ì´ì „íŠ¸ & Function Calling
